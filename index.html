<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‘ãƒãƒ³ã‚³è©³ç´°è¨ˆç®—ãƒ„ãƒ¼ãƒ«</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            background-color: #f0f0f5;
            color: #333;
            line-height: 1.6;
            padding: 0;
            margin: 0;
            min-height: 100vh;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            position: relative;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .app-title {
            font-size: 20px;
            font-weight: bold;
        }

        /* ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
        .hamburger-menu {
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            padding: 5px;
        }

        .hamburger-bar {
            width: 100%;
            height: 3px;
            background-color: white;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
        .nav-menu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 280px;
            height: 100vh;
            background: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            padding: 60px 20px 20px;
            overflow-y: auto;
        }

        .nav-menu.active {
            right: 0;
        }

        .nav-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 999;
        }

        .nav-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .nav-section {
            margin-bottom: 15px;
        }

        .nav-section-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 5px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .nav-section-title:hover {
            background: #e3f2fd;
            border-color: #667eea;
        }

        .nav-section-title::after {
            content: 'â–¼';
            font-size: 12px;
            transition: transform 0.3s ease;
        }

        .nav-section-title.collapsed::after {
            transform: rotate(-90deg);
        }

        .nav-section-content {
            max-height: 300px;
            overflow-y: auto;
            transition: all 0.3s ease;
        }

        .nav-section-content.collapsed {
            max-height: 0;
            overflow: hidden;
        }

        .machine-item {
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .machine-item:hover {
            background: #e3f2fd;
            border-color: #667eea;
        }

        .machine-name {
            font-weight: bold;
            font-size: 14px;
            color: #333;
        }

        .machine-details {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .close-menu {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #333;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }
        
        .section {
            background-color: white;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #333;
            padding-bottom: 6px;
            border-bottom: 1px solid #eee;
        }
        
        .form-group {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .form-label {
            width: 80px;
            font-size: 12px;
            font-weight: 500;
            flex-shrink: 0;
        }
        
        .form-input {
            flex: 1;
            height: 32px;
            padding: 0 8px;
            border: 1px solid #cccccc;
            border-radius: 5px;
            font-size: 11px;
            background-color: white;
            min-width: 0;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .form-input:disabled {
            background-color: #f5f5f5;
            color: #666666;
        }
        
        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        
        .btn {
            flex: 1;
            height: 40px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn-save {
            background-color: #4CAF50;
        }
        
        .btn-save:hover {
            background-color: #45a049;
        }
        
        .btn-load {
            background-color: #2196F3;
        }
        
        .btn-load:hover {
            background-color: #0b7dda;
        }
        
        .btn-add {
            background-color: #FF9800;
        }
        
        .btn-add:hover {
            background-color: #e68900;
        }
        
        .btn-memo {
            background-color: #9C27B0;
        }
        
        .btn-memo:hover {
            background-color: #7B1FA2;
        }
        
        .result-box {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #dddddd;
            background-color: white;
            margin-top: 12px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        
        .positive {
            color: #008000;
        }
        
        .negative {
            color: #FF4500;
        }
        
        .neutral {
            color: #666666;
        }
        
        .hit-data-container {
            display: flex;
            gap: 3px;
            margin-bottom: 10px;
            padding: 6px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        
        .hit-field {
            flex: 1;
            min-width: 50px;
        }
        
        .hit-field input {
            width: 100%;
            font-size: 9px;
            height: 28px;
            padding: 0 4px;
        }
        
        .ratio-input {
            text-align: center;
            font-weight: bold;
            font-size: 12px;
            color: #000000;
            background-color: #ffe8e8;
        }
        
        .ratio-good {
            background-color: #e8ffe8;
        }
        
        .ratio-medium {
            background-color: #fff8e8;
        }

        .calculation-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .calculation-label {
            font-size: 13px;
            font-weight: 500;
            color: #333;
        }

        .calculation-value {
            font-size: 13px;
            font-weight: bold;
            color: #333;
            background: none;
            border: none;
            padding: 0;
            margin: 0;
        }

        /* ã‚¹ãƒãƒ›ç”¨ã®èª¿æ•´ */
        @media (max-width: 480px) {
            .container {
                padding: 8px;
            }
            
            .section {
                padding: 10px;
                margin-bottom: 12px;
            }
            
            .form-group {
                flex-direction: column;
                align-items: flex-start;
                margin-bottom: 10px;
            }
            
            .form-label {
                width: 100%;
                margin-bottom: 4px;
                font-size: 11px;
            }
            
            .form-input {
                width: 100%;
                height: 36px;
                font-size: 14px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                height: 44px;
                font-size: 16px;
            }
            
            .hit-data-container {
                flex-direction: column;
                gap: 5px;
            }
            
            .hit-field {
                width: 100%;
            }
            
            .hit-field input {
                height: 36px;
                font-size: 14px;
            }
            
            .result-box {
                font-size: 16px;
                padding: 12px;
            }

            .calculation-display {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .calculation-value {
                width: 100%;
                text-align: left;
            }
        }

        /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç”¨ã®èª¿æ•´ */
        @media (min-width: 481px) and (max-width: 768px) {
            .container {
                max-width: 95%;
                padding: 12px;
            }
            
            .form-label {
                width: 90px;
            }

            .hit-field {
                min-width: 60px;
            }
        }

        /* PCç”¨ã®èª¿æ•´ */
        @media (min-width: 769px) {
            .container {
                max-width: 800px;
                padding: 15px;
            }

            .hit-field {
                min-width: 70px;
            }
        }
    </style>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
        <div class="header-content">
            <div class="app-title">ãƒ‘ãƒãƒ³ã‚³è¨ˆç®—ãƒ„ãƒ¼ãƒ«</div>
            <div class="hamburger-menu" id="hamburgerMenu">
                <div class="hamburger-bar"></div>
                <div class="hamburger-bar"></div>
                <div class="hamburger-bar"></div>
            </div>
        </div>
    </div>

    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <div class="nav-overlay" id="navOverlay"></div>
    <div class="nav-menu" id="navMenu">
        <button class="close-menu" id="closeMenu">Ã—</button>
        
        <div class="nav-section">
            <div class="nav-section-title" onclick="toggleSection('popular-machines')">ğŸ† äººæ°—æ©Ÿç¨®ä¸€è¦§</div>
            <div class="nav-section-content" id="popular-machines">
                <div class="machine-item" onclick="loadMachineData('evol')">
                    <div class="machine-name">CR EVOL</div>
                    <div class="machine-details">ç¢ºç‡: 1/9.9 | äº¤æ›ç‡: 4.0 | ãƒœãƒ¼ãƒ€ãƒ¼: 20.0</div>
                </div>
                
                <div class="machine-item" onclick="loadMachineData('pawa')">
                    <div class="machine-name">P AWAKENING</div>
                    <div class="machine-details">ç¢ºç‡: 1/9.5 | äº¤æ›ç‡: 4.0 | ãƒœãƒ¼ãƒ€ãƒ¼: 19.5</div>
                </div>
                
                <div class="machine-item" onclick="loadMachineData('fever')">
                    <div class="machine-name">FEVER BREAK</div>
                    <div class="machine-details">ç¢ºç‡: 1/10.5 | äº¤æ›ç‡: 3.8 | ãƒœãƒ¼ãƒ€ãƒ¼: 21.0</div>
                </div>
                
                <div class="machine-item" onclick="loadMachineData('god')">
                    <div class="machine-name">GOD EG</div>
                    <div class="machine-details">ç¢ºç‡: 1/8.9 | äº¤æ›ç‡: 4.2 | ãƒœãƒ¼ãƒ€ãƒ¼: 18.0</div>
                </div>
                
                <div class="machine-item" onclick="loadMachineData('shinobi')">
                    <div class="machine-name">SHINOBI</div>
                    <div class="machine-details">ç¢ºç‡: 1/11.2 | äº¤æ›ç‡: 3.6 | ãƒœãƒ¼ãƒ€ãƒ¼: 22.5</div>
                </div>
                
                <div class="machine-item" onclick="loadMachineData('hokuto')">
                    <div class="machine-name">åŒ—æ–—ã®æ‹³</div>
                    <div class="machine-details">ç¢ºç‡: 1/10.8 | äº¤æ›ç‡: 3.7 | ãƒœãƒ¼ãƒ€ãƒ¼: 21.8</div>
                </div>
                
                <div class="machine-item" onclick="loadMachineData('mario')">
                    <div class="machine-name">ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒãƒªã‚ª</div>
                    <div class="machine-details">ç¢ºç‡: 1/9.2 | äº¤æ›ç‡: 4.1 | ãƒœãƒ¼ãƒ€ãƒ¼: 18.8</div>
                </div>
                
                <div class="machine-item" onclick="loadMachineData('onepiece')">
                    <div class="machine-name">ONE PIECE</div>
                    <div class="machine-details">ç¢ºç‡: 1/10.2 | äº¤æ›ç‡: 3.9 | ãƒœãƒ¼ãƒ€ãƒ¼: 20.8</div>
                </div>
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-section-title" onclick="toggleSection('classic-machines')">ğŸ¯ å®šç•ªæ©Ÿç¨®</div>
            <div class="nav-section-content collapsed" id="classic-machines">
                <div class="machine-item" onclick="loadMachineData('goku')">
                    <div class="machine-name">ãƒ‰ãƒ©ã‚´ãƒ³ãƒœãƒ¼ãƒ«</div>
                    <div class="machine-details">ç¢ºç‡: 1/9.8 | äº¤æ›ç‡: 4.0 | ãƒœãƒ¼ãƒ€ãƒ¼: 19.6</div>
                </div>
                
                <div class="machine-item" onclick="loadMachineData('evangelion')">
                    <div class="machine-name">ã‚¨ãƒ´ã‚¡ãƒ³ã‚²ãƒªã‚ªãƒ³</div>
                    <div class="machine-details">ç¢ºç‡: 1/10.1 | äº¤æ›ç‡: 3.9 | ãƒœãƒ¼ãƒ€ãƒ¼: 20.5</div>
                </div>
                
                <div class="machine-item" onclick="loadMachineData('kamen')">
                    <div class="machine-name">ä»®é¢ãƒ©ã‚¤ãƒ€ãƒ¼</div>
                    <div class="machine-details">ç¢ºç‡: 1/9.6 | äº¤æ›ç‡: 4.0 | ãƒœãƒ¼ãƒ€ãƒ¼: 19.2</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚³ãƒ³ãƒ†ãƒŠéƒ¨åˆ†ã¯å¤‰æ›´ãªã— -->
    <div class="container">
        <!-- æ©Ÿç¨®ãƒ‡ãƒ¼ã‚¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="section" id="machine-data">
            <div class="section-title">æ©Ÿç¨®ãƒ‡ãƒ¼ã‚¿</div>
            
            <div class="form-group">
                <label class="form-label">äº¤æ›ç‡</label>
                <input type="text" class="form-input" id="exchange_rate_input" placeholder="3.63" value="3.63">
            </div>
            
            <div class="form-group">
                <label class="form-label">ãƒˆãƒ¼ã‚¿ãƒ«ç¢ºç‡</label>
                <input type="text" class="form-input" id="probability_input" placeholder="9.5" value="9.5">
            </div>
            
            <div class="form-group">
                <label class="form-label">æ¸¡ç‰</label>
                <input type="text" class="form-input" id="given_balls_input" placeholder="ç‰æ•°">
            </div>
            
            <div class="form-group">
                <label class="form-label">å—ç‰</label>
                <input type="text" class="form-input" id="received_balls_input" placeholder="ç‰æ•°">
            </div>
            
            <div class="form-group">
                <label class="form-label">ç¾é‡‘æŠ•è³‡</label>
                <input type="text" class="form-input" id="cash_input" placeholder="ç‰æ•°">
            </div>
            
            <div class="form-group">
                <label class="form-label">è²¯ç‰æŠ•è³‡</label>
                <input type="text" class="form-input" id="ball_investment_input" placeholder="ç‰æ•°">
            </div>
            
            <div class="form-group">
                <label class="form-label">æŒã¡ç‰</label>
                <input type="text" class="form-input" id="owned_balls_input" placeholder="ç‰æ•°">
            </div>
            
            <div class="form-group">
                <label class="form-label">æŒç‰æ¯”ç‡</label>
                <input type="text" class="form-input ratio-input" id="ball_ratio_input" placeholder="0.0%">
            </div>
        </div>
        
        <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="section" id="data-management">
            <div class="section-title">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</div>
            
            <div class="button-group">
                <button class="btn btn-save" id="save_button">ãƒ‡ãƒ¼ã‚¿ä¿å­˜</button>
                <button class="btn btn-load" id="load_button">ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿</button>
                <button class="btn btn-memo" id="memo_button">ãƒ¡ãƒ¢å¸³ã«ä¿å­˜</button>
            </div>
        </div>
        
        <!-- åˆå½“ã‚Šãƒ‡ãƒ¼ã‚¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="section" id="hit-data">
            <div class="section-title">åˆå½“ã‚Šãƒ‡ãƒ¼ã‚¿</div>
            
            <button class="btn btn-add" id="start_button">ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ </button>
            
            <div id="hit_data_container">
                <!-- åˆå½“ã‚Šãƒ‡ãƒ¼ã‚¿ãŒã“ã“ã«å‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
            </div>
        </div>
        
        <!-- ä»•äº‹é‡è¨ˆç®—ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="section" id="calculation">
            <div class="section-title">ä»•äº‹é‡è¨ˆç®—</div>
            
            <div class="calculation-display">
                <span class="calculation-label">é€šå¸¸å›è»¢æ•°</span>
                <span class="calculation-value" id="rotation_display">0</span>
            </div>
            
            <div class="calculation-display">
                <span class="calculation-label">å›è»¢ç‡</span>
                <span class="calculation-value" id="rate_display">0.00</span>
            </div>
            
            <div class="calculation-display">
                <span class="calculation-label">ç­‰ä¾¡ãƒœãƒ¼ãƒ€ãƒ¼</span>
                <span class="calculation-value" id="border_display">0.00</span>
            </div>
            
            <div class="calculation-display">
                <span class="calculation-label">æŒã¡ç‰å˜ä¾¡</span>
                <span class="calculation-value" id="unit_price_display">0.00</span>
            </div>
            
            <div class="calculation-display">
                <span class="calculation-label">ç¾é‡‘å˜ä¾¡</span>
                <span class="calculation-value" id="cash_unit_price_display">0.00</span>
            </div>
            
            <div class="calculation-display">
                <span class="calculation-label">1Rå‡ºç‰</span>
                <span class="calculation-value" id="ball_per_round_display">0.00</span>
            </div>
            
            <div class="result-box" id="result_label">
                ä»•äº‹é‡: Â¥0
            </div>
            
            <div class="result-box" id="profit_label">
                åæ”¯: Â¥0
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let firstHitCount = 0;
        let firstHitFields = [];
        
        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜ç”¨ã®ã‚­ãƒ¼
        const DATA_KEY = 'pachinko_data';
        
        // æ©Ÿç¨®ãƒ‡ãƒ¼ã‚¿ã®å®šç¾©ï¼ˆè¿½åŠ ï¼‰
        const machineData = {
            'evol': {
                probability: '9.9',
                exchangeRate: '4.0'
            },
            'pawa': {
                probability: '9.5',
                exchangeRate: '4.0'
            },
            'fever': {
                probability: '10.5',
                exchangeRate: '3.8'
            },
            'god': {
                probability: '8.9',
                exchangeRate: '4.2'
            },
            'shinobi': {
                probability: '11.2',
                exchangeRate: '3.6'
            },
            'hokuto': {
                probability: '10.8',
                exchangeRate: '3.7'
            },
            'mario': {
                probability: '9.2',
                exchangeRate: '4.1'
            },
            'onepiece': {
                probability: '10.2',
                exchangeRate: '3.9'
            },
            'goku': {
                probability: '9.8',
                exchangeRate: '4.0'
            },
            'evangelion': {
                probability: '10.1',
                exchangeRate: '3.9'
            },
            'kamen': {
                probability: '9.6',
                exchangeRate: '4.0'
            }
        };
        
        // DOMã®èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«å®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
            setupEventListeners();
            
            // åˆæœŸè¨ˆç®—ã‚’å®Ÿè¡Œ
            calculateAll();
        });
        
        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–‹é–‰ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹é–¢æ•°
        function toggleSection(sectionId) {
            const sectionContent = document.getElementById(sectionId);
            const sectionTitle = sectionContent.previousElementSibling;
            
            sectionContent.classList.toggle('collapsed');
            sectionTitle.classList.toggle('collapsed');
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        function setupEventListeners() {
            // æ©Ÿç¨®ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆæŒã¡ç‰æ¯”ç‡ã‚’å«ã‚€ï¼‰
            const machineFields = [
                'exchange_rate_input', 'probability_input', 'given_balls_input',
                'received_balls_input', 'cash_input', 'ball_investment_input',
                'owned_balls_input', 'ball_ratio_input'
            ];
            
            machineFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', calculateAll);
                    field.addEventListener('blur', calculateAll);
                }
            });
            
            // ãƒœã‚¿ãƒ³
            document.getElementById('save_button').addEventListener('click', saveData);
            document.getElementById('load_button').addEventListener('click', loadData);
            document.getElementById('start_button').addEventListener('click', addFirstHitFields);
            document.getElementById('memo_button').addEventListener('click', saveToMemoApp);
            
            // ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼
            document.getElementById('hamburgerMenu').addEventListener('click', toggleMenu);
            document.getElementById('closeMenu').addEventListener('click', toggleMenu);
            document.getElementById('navOverlay').addEventListener('click', toggleMenu);
            
            // èƒŒæ™¯ã‚¿ãƒƒãƒ—ã§ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’é–‰ã˜ã‚‹
            document.body.addEventListener('click', function(e) {
                if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'BUTTON') {
                    closeKeyboard();
                }
            });
        }
        
        // ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®é–‹é–‰
        function toggleMenu() {
            const navMenu = document.getElementById('navMenu');
            const navOverlay = document.getElementById('navOverlay');
            const hamburgerMenu = document.getElementById('hamburgerMenu');
            
            navMenu.classList.toggle('active');
            navOverlay.classList.toggle('active');
            hamburgerMenu.classList.toggle('active');
        }
        
        // æ©Ÿç¨®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
        function loadMachineData(machineId) {
            const data = machineData[machineId];
            if (data) {
                document.getElementById('probability_input').value = data.probability;
                document.getElementById('exchange_rate_input').value = data.exchangeRate;
                calculateAll();
                toggleMenu(); // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
                alert('æ©Ÿç¨®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼');
            }
        }
        
        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’é–‰ã˜ã‚‹
        function closeKeyboard() {
            document.activeElement.blur();
        }
        
        // ä»¥ä¸‹ã¯æ—¢å­˜ã®é–¢æ•°ï¼ˆsaveToMemoApp, collectCurrentData, createMemoText, openMemoApp, saveData, loadData, addFirstHitFields, createTextField, calculateJobAmount, calculateProfit, calculateEquivalentBorder, calculateUnitPrices, calculateTotalRotation, calculateTotalBallsAndRounds, calculateAllï¼‰ã¯å¤‰æ›´ãªã—
        // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã“ã‚Œã‚‰ã®é–¢æ•°ã‚‚å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
        
        // ãƒ¡ãƒ¢å¸³ã‚¢ãƒ—ãƒªã«ä¿å­˜ã™ã‚‹é–¢æ•°
        function saveToMemoApp() {
            // ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’åé›†
            const currentData = collectCurrentData();
            
            // ãƒ¡ãƒ¢å¸³ç”¨ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆ
            const memoText = createMemoText(currentData);
            
            // ãƒ¡ãƒ¢å¸³ã‚¢ãƒ—ãƒªã‚’é–‹ã
            openMemoApp(memoText);
            
            toggleMenu(); // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
        }
        
        // ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’åé›†
        function collectCurrentData() {
            const data = {
                date: new Date().toLocaleString('ja-JP'),
                exchangeRate: document.getElementById('exchange_rate_input').value,
                probability: document.getElementById('probability_input').value,
                givenBalls: document.getElementById('given_balls_input').value,
                receivedBalls: document.getElementById('received_balls_input').value,
                cashInvestment: document.getElementById('cash_input').value,
                ballInvestment: document.getElementById('ball_investment_input').value,
                ownedBalls: document.getElementById('owned_balls_input').value,
                ballRatio: document.getElementById('ball_ratio_input').value,
                totalRotation: document.getElementById('rotation_display').textContent,
                rate: document.getElementById('rate_display').textContent,
                equivalentBorder: document.getElementById('border_display').textContent,
                ownedUnitPrice: document.getElementById('unit_price_display').textContent,
                cashUnitPrice: document.getElementById('cash_unit_price_display').textContent,
                ballPerRound: document.getElementById('ball_per_round_display').textContent,
                jobAmount: document.getElementById('result_label').textContent,
                profit: document.getElementById('profit_label').textContent,
                hitData: []
            };
            
            // åˆå½“ã‚Šãƒ‡ãƒ¼ã‚¿ã‚’åé›†
            for (let i = 1; i <= firstHitCount; i++) {
                const fieldSetId = `hit_${i}`;
                const hitData = {
                    rotation: document.getElementById(`${fieldSetId}_rotation`)?.value || '',
                    balls: document.getElementById(`${fieldSetId}_balls`)?.value || '',
                    rounds: document.getElementById(`${fieldSetId}_rounds`)?.value || '',
                    time: document.getElementById(`${fieldSetId}_time`)?.value || ''
                };
                data.hitData.push(hitData);
            }
            
            return data;
        }
        
        // ãƒ¡ãƒ¢å¸³ç”¨ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆ
        function createMemoText(data) {
            let text = `ğŸ° ãƒ‘ãƒãƒ³ã‚³è¨ˆç®—ãƒ‡ãƒ¼ã‚¿\n`;
            text += `æ—¥æ™‚: ${data.date}\n\n`;
            
            text += `ã€æ©Ÿç¨®ãƒ‡ãƒ¼ã‚¿ã€‘\n`;
            text += `äº¤æ›ç‡: ${data.exchangeRate}\n`;
            text += `ãƒˆãƒ¼ã‚¿ãƒ«ç¢ºç‡: ${data.probability}\n`;
            text += `æ¸¡ç‰: ${data.givenBalls || '0'}\n`;
            text += `å—ç‰: ${data.receivedBalls || '0'}\n`;
            text += `ç¾é‡‘æŠ•è³‡: ${data.cashInvestment || '0'}\n`;
            text += `è²¯ç‰æŠ•è³‡: ${data.ballInvestment || '0'}\n`;
            text += `æŒã¡ç‰: ${data.ownedBalls || '0'}\n`;
            text += `æŒç‰æ¯”ç‡: ${data.ballRatio || '0.0%'}\n\n`;
            
            if (data.hitData.length > 0) {
                text += `ã€åˆå½“ã‚Šãƒ‡ãƒ¼ã‚¿ã€‘\n`;
                data.hitData.forEach((hit, index) => {
                    if (hit.rotation || hit.balls || hit.rounds || hit.time) {
                        text += `#${index + 1}: å›è»¢${hit.rotation} / å‡ºç‰${hit.balls} / ãƒ©ã‚¦ãƒ³ãƒ‰${hit.rounds} / æ™‚çŸ­${hit.time}\n`;
                    }
                });
                text += `\n`;
            }
            
            text += `ã€è¨ˆç®—çµæœã€‘\n`;
            text += `é€šå¸¸å›è»¢æ•°: ${data.totalRotation}\n`;
            text += `å›è»¢ç‡: ${data.rate}\n`;
            text += `ç­‰ä¾¡ãƒœãƒ¼ãƒ€ãƒ¼: ${data.equivalentBorder}\n`;
            text += `æŒã¡ç‰å˜ä¾¡: ${data.ownedUnitPrice}\n`;
            text += `ç¾é‡‘å˜ä¾¡: ${data.cashUnitPrice}\n`;
            text += `1Rå‡ºç‰: ${data.ballPerRound}\n`;
            text += `${data.jobAmount}\n`;
            text += `${data.profit}\n\n`;
            
            text += `â€»ã“ã®ãƒ‡ãƒ¼ã‚¿ã¯ãƒ‘ãƒãƒ³ã‚³è¨ˆç®—ãƒ„ãƒ¼ãƒ«ã§ä½œæˆã•ã‚Œã¾ã—ãŸ`;
            
            return text;
        }
        
        // ãƒ¡ãƒ¢å¸³ã‚¢ãƒ—ãƒªã‚’é–‹ã
        function openMemoApp(text) {
            // ãƒ¡ãƒ¼ãƒ«toãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ï¼ˆiOS/Androidã§ãƒ¡ãƒ¢å¸³ã‚¢ãƒ—ãƒªã‚’é–‹ãï¼‰
            const subject = encodeURIComponent('ãƒ‘ãƒãƒ³ã‚³è¨ˆç®—ãƒ‡ãƒ¼ã‚¿');
            const body = encodeURIComponent(text);
            
            // ãƒ¡ãƒ¼ãƒ©ãƒ¼ã‚’é–‹ãï¼ˆãƒ¡ãƒ¢å¸³ã‚¢ãƒ—ãƒªã¸ã®è¿‘é“ï¼‰
            const mailtoLink = `mailto:?subject=${subject}&body=${body}`;
            
            // ãƒªãƒ³ã‚¯ã‚’é–‹ã
            window.location.href = mailtoLink;
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«èª¬æ˜ã‚’è¡¨ç¤º
            setTimeout(() => {
                alert('ãƒ¡ãƒ¼ãƒ©ãƒ¼ãŒé–‹ãã¾ã—ãŸï¼\n\nã€ä¿å­˜æ–¹æ³•ã€‘\n1. æœ¬æ–‡ã‚’å…¨é¸æŠï¼ˆã‚³ãƒ”ãƒ¼ï¼‰\n2. ãƒ¡ãƒ¢å¸³ã‚¢ãƒ—ãƒªã‚’é–‹ã\n3. æ–°ã—ã„ãƒ¡ãƒ¢ã‚’ä½œæˆ\n4. ã‚³ãƒ”ãƒ¼ã—ãŸãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘\n5. ä¿å­˜ã—ã¦ãã ã•ã„');
            }, 1000);
        }
        
        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜é–¢æ•°
        function saveData() {
            const data = {
                firstHitCount: firstHitCount,
                firstHitData: {},
                machineData: {}
            };
            
            // æ©Ÿç¨®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            const machineFields = [
                'exchange_rate_input', 'probability_input', 'given_balls_input',
                'received_balls_input', 'cash_input', 'ball_investment_input',
                'owned_balls_input', 'ball_ratio_input'
            ];
            
            machineFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    data.machineData[fieldId] = field.value || '';
                }
            });
            
            // åˆå½“ã‚Šãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            for (let i = 1; i <= firstHitCount; i++) {
                const fieldSetId = `hit_${i}`;
                const hitData = {};
                
                const rotationField = document.getElementById(`${fieldSetId}_rotation`);
                const ballsField = document.getElementById(`${fieldSetId}_balls`);
                const roundsField = document.getElementById(`${fieldSetId}_rounds`);
                const timeField = document.getElementById(`${fieldSetId}_time`);
                
                if (rotationField) hitData.rotation = rotationField.value || '';
                if (ballsField) hitData.balls = ballsField.value || '';
                if (roundsField) hitData.rounds = roundsField.value || '';
                if (timeField) hitData.time = timeField.value || '';
                
                data.firstHitData[fieldSetId] = hitData;
            }
            
            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
            try {
                localStorage.setItem(DATA_KEY, JSON.stringify(data));
                alert('ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            } catch (e) {
                alert('ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚¨ãƒ©ãƒ¼: ' + e.message);
            }
        }
        
        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–¢æ•°
        function loadData() {
            try {
                const dataStr = localStorage.getItem(DATA_KEY);
                if (!dataStr) {
                    alert('ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const data = JSON.parse(dataStr);
                
                // æ©Ÿç¨®ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
                if (data.machineData) {
                    Object.keys(data.machineData).forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (field) {
                            field.value = data.machineData[fieldId];
                        }
                    });
                }
                
                // åˆå½“ã‚Šãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
                const savedHitCount = data.firstHitCount || 0;
                const firstHitData = data.firstHitData || {};
                
                // æ—¢å­˜ã®åˆå½“ã‚Šãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                const hitDataContainer = document.getElementById('hit_data_container');
                hitDataContainer.innerHTML = '';
                firstHitCount = 0;
                firstHitFields = [];
                
                // å¿…è¦ãªåˆ†ã ã‘ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 
                for (let i = 1; i <= savedHitCount; i++) {
                    addFirstHitFields();
                    
                    const fieldSetId = `hit_${i}`;
                    if (firstHitData[fieldSetId]) {
                        const hitData = firstHitData[fieldSetId];
                        
                        const rotationField = document.getElementById(`${fieldSetId}_rotation`);
                        const ballsField = document.getElementById(`${fieldSetId}_balls`);
                        const roundsField = document.getElementById(`${fieldSetId}_rounds`);
                        const timeField = document.getElementById(`${fieldSetId}_time`);
                        
                        if (rotationField && hitData.rotation) rotationField.value = hitData.rotation;
                        if (ballsField && hitData.balls) ballsField.value = hitData.balls;
                        if (roundsField && hitData.rounds) roundsField.value = hitData.rounds;
                        if (timeField && hitData.time) timeField.value = hitData.time;
                    }
                }
                
                alert('ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
                calculateAll();
                
            } catch (e) {
                alert('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ' + e.message);
            }
        }
        
        // åˆå½“ã‚Šãƒ‡ãƒ¼ã‚¿å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã®è¿½åŠ 
        function addFirstHitFields() {
            firstHitCount++;
            const fieldSetId = `hit_${firstHitCount}`;
            
            const hitDataContainer = document.getElementById('hit_data_container');
            
            const fieldContainer = document.createElement('div');
            fieldContainer.className = 'hit-data-container';
            fieldContainer.id = `${fieldSetId}_container`;
            
            // å›è»¢æ•°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
            const rotationField = createTextField(fieldSetId, 'rotation', 'å›è»¢æ•°');
            fieldContainer.appendChild(rotationField);
            
            // å‡ºç‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
            const ballsField = createTextField(fieldSetId, 'balls', 'å‡ºç‰');
            fieldContainer.appendChild(ballsField);
            
            // ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
            const roundsField = createTextField(fieldSetId, 'rounds', 'ãƒ©ã‚¦ãƒ³ãƒ‰');
            fieldContainer.appendChild(roundsField);
            
            // æ™‚çŸ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
            const timeField = createTextField(fieldSetId, 'time', 'æ™‚çŸ­');
            fieldContainer.appendChild(timeField);
            
            hitDataContainer.appendChild(fieldContainer);
            firstHitFields.push(fieldSetId);
            
            // è¨ˆç®—ã‚’æ›´æ–°
            calculateAll();
        }
        
        // ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä½œæˆãƒ˜ãƒ«ãƒ‘ãƒ¼
        function createTextField(fieldSetId, fieldType, placeholder) {
            const container = document.createElement('div');
            container.className = 'hit-field';
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'form-input';
            input.id = `${fieldSetId}_${fieldType}`;
            input.placeholder = placeholder;
            
            input.addEventListener('input', calculateAll);
            input.addEventListener('blur', calculateAll);
            
            container.appendChild(input);
            return container;
        }
        
        // ä»•äº‹é‡è¨ˆç®—
        function calculateJobAmount(totalRotation, ballRatio, ownedUnitPrice, cashUnitPrice) {
            try {
                const T = parseFloat(totalRotation);
                const ratio = ballRatio ? parseFloat(ballRatio) : 0;
                const ownedUnit = parseFloat(ownedUnitPrice);
                const cashUnit = parseFloat(cashUnitPrice);
                
                // ä»•äº‹é‡ = ç·å›è»¢æ•° Ã— (æŒã¡ç‰æ¯”ç‡/100) Ã— æŒã¡ç‰å˜ä¾¡ + ç·å›è»¢æ•° Ã— (1 - (æŒã¡ç‰æ¯”ç‡/100)) Ã— ç¾é‡‘å˜ä¾¡
                const ownedPart = T * (ratio / 100) * ownedUnit;
                const cashPart = T * (1 - (ratio / 100)) * cashUnit;
                const jobAmount = ownedPart + cashPart;
                
                return jobAmount;
            } catch (e) {
                return null;
            }
        }
        
        // åæ”¯è¨ˆç®—
        function calculateProfit(cashInvestment, ballInvestment, ownedBalls, exchangeRate) {
            try {
                const cash = parseFloat(cashInvestment);
                const ballInv = parseFloat(ballInvestment);
                const owned = parseFloat(ownedBalls);
                const rate = parseFloat(exchangeRate);
                
                // åæ”¯ = (æŒã¡ç‰ - è²¯ç‰æŠ•è³‡) * äº¤æ›ç‡ - (ç¾é‡‘æŠ•è³‡ * 4)
                const profit = (owned - ballInv) * rate - (cash * 4);
                return profit;
            } catch (e) {
                return null;
            }
        }
        
        // ç­‰ä¾¡ãƒœãƒ¼ãƒ€ãƒ¼ã‚’è¨ˆç®—
        function calculateEquivalentBorder(ballPerRound, totalProbability) {
            try {
                if (ballPerRound > 0 && parseFloat(totalProbability) > 0) {
                    // ç­‰ä¾¡ãƒœãƒ¼ãƒ€ãƒ¼ = 250 / (1Rå‡ºç‰ / ãƒˆãƒ¼ã‚¿ãƒ«ç¢ºç‡)
                    const equivalentBorder = 250 / (ballPerRound / parseFloat(totalProbability));
                    return equivalentBorder;
                } else {
                    return 0;
                }
            } catch (e) {
                return 0;
            }
        }
        
        // å˜ä¾¡ã‚’è¨ˆç®—
        function calculateUnitPrices(ballPerRound, totalProbability, exchangeRate, actualRate) {
            try {
                if (ballPerRound > 0 && parseFloat(totalProbability) > 0 && 
                    parseFloat(exchangeRate) > 0 && actualRate > 0) {
                    
                    const baseValue = (ballPerRound / parseFloat(totalProbability)) * parseFloat(exchangeRate);
                    
                    // æŒã¡ç‰å˜ä¾¡ = (1Rå‡ºç‰ / ãƒˆãƒ¼ã‚¿ãƒ«ç¢ºç‡) Ã— äº¤æ›ç‡ - (250 / å›è»¢ç‡) Ã— äº¤æ›ç‡
                    const ownedUnitPrice = baseValue - (250 / actualRate) * parseFloat(exchangeRate);
                    
                    // ç¾é‡‘å˜ä¾¡ = (1Rå‡ºç‰ / ãƒˆãƒ¼ã‚¿ãƒ«ç¢ºç‡) Ã— äº¤æ›ç‡ - (250 / å›è»¢ç‡) Ã— 4
                    const cashUnitPrice = baseValue - (250 / actualRate) * 4;
                    
                    return { ownedUnitPrice, cashUnitPrice };
                } else {
                    return { ownedUnitPrice: 0, cashUnitPrice: 0 };
                }
            } catch (e) {
                return { ownedUnitPrice: 0, cashUnitPrice: 0 };
            }
        }
        
        // åˆå½“ã‚Šãƒ‡ãƒ¼ã‚¿ã‹ã‚‰é€šå¸¸å›è»¢æ•°ã‚’è¨ˆç®—
        function calculateTotalRotation() {
            if (firstHitCount === 0) {
                return 0;
            }
            
            let totalRotation = 0;
            let totalTimeShort = 0;
            
            // å„åˆå½“ã‚Šãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰å€¤ã‚’å–å¾—ã—ã¦è¨ˆç®—
            for (let i = 1; i <= firstHitCount; i++) {
                const fieldSetId = `hit_${i}`;
                
                const rotationField = document.getElementById(`${fieldSetId}_rotation`);
                const timeField = document.getElementById(`${fieldSetId}_time`);
                
                const rotationValue = rotationField && rotationField.value ? rotationField.value : '0';
                const timeValue = timeField && timeField.value ? timeField.value : '0';
                
                try {
                    totalRotation += parseFloat(rotationValue);
                    totalTimeShort += parseFloat(timeValue);
                } catch (e) {
                    // ç„¡åŠ¹ãªå€¤ã¯ç„¡è¦–
                }
            }
            
            // é€šå¸¸å›è»¢æ•° = å›è»¢æ•°ã®åˆè¨ˆ - æ™‚çŸ­ã®åˆè¨ˆ
            const normalRotation = totalRotation - totalTimeShort;
            return Math.max(0, normalRotation);
        }
        
        // ç·ç‰æ•°ã¨ãƒ©ã‚¦ãƒ³ãƒ‰åˆè¨ˆã‚’è¨ˆç®—
        function calculateTotalBallsAndRounds() {
            // æ©Ÿç¨®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å€¤ã‚’å–å¾—
            const cashInvestment = document.getElementById('cash_input').value || '0';
            const ballInvestment = document.getElementById('ball_investment_input').value || '0';
            const givenBalls = document.getElementById('given_balls_input').value || '0';
            const receivedBalls = document.getElementById('received_balls_input').value || '0';
            const ownedBalls = document.getElementById('owned_balls_input').value || '0';
            
            // åˆå½“ã‚Šãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å‡ºç‰ã®åˆè¨ˆã¨ãƒ©ã‚¦ãƒ³ãƒ‰ã®åˆè¨ˆã‚’è¨ˆç®—
            let totalBallOutput = 0;
            let totalRounds = 0;
            
            for (let i = 1; i <= firstHitCount; i++) {
                const fieldSetId = `hit_${i}`;
                
                const ballsField = document.getElementById(`${fieldSetId}_balls`);
                const roundsField = document.getElementById(`${fieldSetId}_rounds`);
                
                const ballValue = ballsField && ballsField.value ? ballsField.value : '0';
                const roundValue = roundsField && roundsField.value ? roundsField.value : '0';
                
                try {
                    totalBallOutput += parseFloat(ballValue);
                    totalRounds += parseFloat(roundValue);
                } catch (e) {
                    // ç„¡åŠ¹ãªå€¤ã¯ç„¡è¦–
                }
            }
            
            try {
                // ç‰æ•° = ç¾é‡‘æŠ•è³‡ + è²¯ç‰æŠ•è³‡ + å—ç‰ - æ¸¡ç‰ + (å‡ºç‰ã®åˆè¨ˆ) - æŒã¡ç‰
                const cash = parseFloat(cashInvestment);
                const ballInv = parseFloat(ballInvestment);
                const given = parseFloat(givenBalls);
                const received = parseFloat(receivedBalls);
                const owned = parseFloat(ownedBalls);
                
                const totalBalls = cash + ballInv + received - given + totalBallOutput - owned;
                
                // 1Rå‡ºç‰ã‚’è¨ˆç®—(ãƒ©ã‚¦ãƒ³ãƒ‰åˆè¨ˆãŒ0ã®å ´åˆã¯0)
                const ballPerRound = totalRounds > 0 ? totalBallOutput / totalRounds : 0;
                
                return {
                    totalBalls: Math.max(0, totalBalls),
                    ballPerRound: ballPerRound
                };
            } catch (e) {
                return {
                    totalBalls: 0,
                    ballPerRound: 0
                };
            }
        }
        
        // è¨ˆç®—å®Ÿè¡Œ
        function calculateAll() {
            // é€šå¸¸å›è»¢æ•°ã‚’åˆå½“ã‚Šãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è‡ªå‹•è¨ˆç®—
            const totalRotation = calculateTotalRotation();
            
            // é€šå¸¸å›è»¢æ•°è¡¨ç¤ºã‚’æ›´æ–°
            document.getElementById('rotation_display').textContent = Math.floor(totalRotation);
            
            // ç·ç‰æ•°ã¨1Rå‡ºç‰ã‚’è¨ˆç®—
            const { totalBalls, ballPerRound } = calculateTotalBallsAndRounds();
            
            // å›è»¢ç‡è¨ˆç®—
            let actualRate = 0;
            if (totalBalls > 0) {
                actualRate = totalRotation / (totalBalls / 250);
            }
            
            // å›è»¢ç‡è¡¨ç¤ºã‚’æ›´æ–°
            document.getElementById('rate_display').textContent = actualRate.toFixed(2);
            
            // 1Rå‡ºç‰è¡¨ç¤ºã‚’æ›´æ–°(å°æ•°ç‚¹ç¬¬2ä½ã¾ã§è¡¨ç¤º)
            document.getElementById('ball_per_round_display').textContent = ballPerRound.toFixed(2);
            
            // ç­‰ä¾¡ãƒœãƒ¼ãƒ€ãƒ¼ã‚’è¨ˆç®—
            const totalProbability = document.getElementById('probability_input').value || '0';
            const equivalentBorder = calculateEquivalentBorder(ballPerRound, totalProbability);
            
            // ç­‰ä¾¡ãƒœãƒ¼ãƒ€ãƒ¼è¡¨ç¤ºã‚’æ›´æ–°
            document.getElementById('border_display').textContent = equivalentBorder.toFixed(2);
            
            // å˜ä¾¡ã‚’è¨ˆç®—
            const exchangeRate = document.getElementById('exchange_rate_input').value || '0';
            const { ownedUnitPrice, cashUnitPrice } = calculateUnitPrices(
                ballPerRound, totalProbability, exchangeRate, actualRate
            );
            
            // æŒã¡ç‰å˜ä¾¡è¡¨ç¤ºã‚’æ›´æ–°
            document.getElementById('unit_price_display').textContent = ownedUnitPrice.toFixed(2);
            
            // ç¾é‡‘å˜ä¾¡è¡¨ç¤ºã‚’æ›´æ–°
            document.getElementById('cash_unit_price_display').textContent = cashUnitPrice.toFixed(2);
            
            // æŒç‰æ¯”ç‡ã®èƒŒæ™¯è‰²ã‚’æ›´æ–°
            const ratioField = document.getElementById('ball_ratio_input');
            const ratioValue = ratioField.value ? parseFloat(ratioField.value) : 0;
            
            if (ratioValue >= 100) {
                ratioField.className = 'form-input ratio-input ratio-good';
            } else if (ratioValue > 0) {
                ratioField.className = 'form-input ratio-input ratio-medium';
            } else {
                ratioField.className = 'form-input ratio-input';
            }
            
            // ä»•äº‹é‡è¨ˆç®—(æ–°ã—ã„è¨ˆç®—å¼ã‚’ä½¿ç”¨)
            const jobAmount = calculateJobAmount(
                totalRotation, 
                ratioValue, 
                ownedUnitPrice, 
                cashUnitPrice
            );
            
            // åæ”¯è¨ˆç®—ã‚’è¿½åŠ 
            const cashInvestment = document.getElementById('cash_input').value || '0';
            const ballInvestment = document.getElementById('ball_investment_input').value || '0';
            const ownedBalls = document.getElementById('owned_balls_input').value || '0';
            const profit = calculateProfit(
                cashInvestment, 
                ballInvestment, 
                ownedBalls, 
                exchangeRate
            );
            
            // çµæœè¡¨ç¤ºã‚’æ›´æ–°
            const resultLabel = document.getElementById('result_label');
            if (jobAmount !== null) {
                resultLabel.textContent = `ä»•äº‹é‡: Â¥${Math.floor(jobAmount).toLocaleString()}`;
                resultLabel.className = jobAmount >= 0 ? 'result-box positive' : 'result-box negative';
            } else {
                resultLabel.textContent = "ä»•äº‹é‡: è¨ˆç®—å¯èƒ½";
                resultLabel.className = 'result-box neutral';
            }
            
            // åæ”¯è¡¨ç¤ºã‚’æ›´æ–°
            const profitLabel = document.getElementById('profit_label');
            if (profit !== null) {
                profitLabel.textContent = `åæ”¯: Â¥${Math.floor(profit).toLocaleString()}`;
                profitLabel.className = profit >= 0 ? 'result-box positive' : 'result-box negative';
            } else {
                profitLabel.textContent = "åæ”¯: è¨ˆç®—ä¸­";
                profitLabel.className = 'result-box neutral';
            }
        }
    </script>
</body>
</html>
